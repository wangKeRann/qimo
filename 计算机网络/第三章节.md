# 数据链路层（成帧、错误处理、流量控制)

#### 物理链路：

传输介质+物理层实现了相邻结点之间的“物理链路”

##### 逻辑链路：

数据链路层需要基于“物理链路”，实现相邻结点之间逻辑上无差错的“数据链路”

## 1. 可靠与效率

可靠控制：
发现并解决”帧错“

- 帧丢失
- 帧重复
- 帧失序

流量控制：控制发送方发送帧的速率别太快，让接收方来得及”接受“

介质访问控制：”广播信道“需要实现此功能。广播信道再逻辑上是总线型拓扑、多个结点需争抢传输介质的使用权；“点对点信道”通常不需要实现此功能。点对点信道通常意味着两个结点之间由专属的传输介质，不用抢。

### 1.1 肯定确认与重传

对于发送方，我们只需要再设计一个计时器，每发送一个数据帧，发送方就开启这个计时器，只要在计时器超时之前，能收到来自接收方的确认，则认为该数据帧被正确收到；否则一旦计时器超时，则自动重发当前数据帧。

### 1.2 滑动窗口

发送窗口内的帧允许被发送

接收窗口内的帧允许被接受

### 1.3 选择重传协议

发送窗口>1，接收窗口>1

### 1.4 后退N帧协议(GBN)

发送窗口>1，接收窗口=1

### 1.5停止-等待协议(S-W)

确认机制：确认帧:ACK_i。若接收方收到i号帧，且没有检测出“差错”，需要给发送方返回确认帧ACK_i

重传机制：超时重传。若发送方超时未收到ACK_i，则重传i号帧

帧编号：仅需1bit给帧“编号”，要求Wt+Wr<=2^n

发送窗口=1，接收窗口=1

## 2. 流量控制

控制发送方发送帧的速率别太快，让接收方”来得及“接受

### 2.1 基于反馈的流量控制
### 2.2 基于速率的流量控制

## 3. 成帧方法

帧定界：如何让接收方能够确定帧的界限

透明传输：接收方链路层要能从收到的帧内恢复原始SDU（服务数据单元），让网络层“感受不到”将分组封装成帧的过程

### 3.1 字节计数法（字符计数法）

原理：在每个帧开头，用一个定长计数字段表示帧长

最大缺点：任何一个计数字段出错，都会导致后续所有帧无法定界

### 3.2 字节填充的标志字节法（字节填充法）

控制字符SOH、EOT作为开始和结束标志

转义字符ESC->避免内容有控制字符

### 3.3 比特填充的标志比特法（零比特填充法）

特殊比特串01111110（六个1）表示开始/结束

发送发需要对帧的数据部分进行处理，每当遇到连续5个1，就在后方填充一个0

接收方需要对帧的数据部分进行你处理，每当遇到连续5个1，就删掉后面的0

例子：HDLC协议、PPP协议

### 3.4 物理层编码违例法（违规编码法）

需要物理层配合，使用“违规信号”表示帧的开头、结尾

曼彻斯特编码：上跳0下跳1看中间，中必变。

如果周期中间不跳变，则"违例"

## 4. 差错处理

发现并解决一个帧内部的“位错

解决方案一：接收方发现比特错后丢弃帧，发送方重传帧（仅需采用检错编码）

解决方案二：由接收方发现并纠正比特错误（需采用纠错编码）

### 4.1 检错（重要）

接收方发现比特错后丢弃帧，并通知发送发重传帧

- 奇偶校验

  添加校验位后，总共1的个数是奇数->奇检验码

  添加校验位后，总共1的个数是偶数->偶检验码

  发送方用异或求校验位

  接收方异或检查

- 互联网校验和

- 循环冗余校验CRC

  数据发送、接收方约定一个“除数”

  K个信息位+R个校验位作为“被除数”。添加检验位后需保证出发的余数为0

  收到数据后，进行除法检查余数是否为0

  题目会给一个生成多项式->指明除数

  K = 信息码长度

  R = 生成多项式的最幂

  信息位 校验位

  如何求？
  左移R位补0

  进行除法

  最后得到的余数就是校验位

  这里的相减就是异或

  可以纠正一位错：
  $$
  2^R>= K + R + 1
  $$
### 4.2 纠错

由接收方发现并纠正比特错误

- 海明码

- 纠错1位，检错2位

  添加全校验位判断是1位错还是2位错

  k个校验位
  $$
  2^k>=n+k+1
  $$
  校验位Pi放在海明码位号为2^(i-1)的位置上

  

- 二进制卷积码

- 里德所罗门码

- 低密度奇偶校验码

## 5. 协议实例（重要）
### 5.1 HDLC
### 5.2 PPP（点对点协议）
- 成帧的方法
- 链路控制协议 LCP
- 网络控制协议 NCP
### 5.3 PPPoE（以太网上的PPP协议）
- 成帧的方法
- 链路控制协议 LCP
- 网络控制协议 NCP

PPPoE的工作过程总体可分为三个阶段：发现阶段、会话阶段以及终止阶段。